-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /nas-vol/projects/data_vol4/wkerr_ethnicity_project/networks/macro
> /replication/nw-macro-1a.log
  log type:  text
 opened on:   1 Sep 2015, 08:12:09

.  * William Kerr, TGG;
. * Data Grid Preparation;
. * stata-mp8-20g -b do nw-macro-1a.do;
. * Last Modified: May 2015;
. clear all;

.  set matsize 5000;

.  set more off;

. local znber3 *nber_emp *nber_vadd *nber_rvadd *nber_lprod *nber_rlprod;

. **************************;
. *** Grid prep           **;
. **************************;
. *** Prepare symmetric grid;
. use ./raw/main_annual_format, clear;

.  des;

Contains data from ./raw/main_annual_format.dta
  obs:         8,232                          
 vars:           124                          17 Dec 2014 20:14
 size:     4,741,632                          
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
sic87dd         int     %9.0g                 
year            int     %9.0g                 
sic87dd_desc    str41   %41s                  
manuf           byte    %9.0g                 
reclassified    byte    %9.0g                 
cbp_emp         double  %12.0g                (sum) emp
cbp_real_pay    float   %9.0g                 
cbp_nom_pay     double  %12.0g                (sum) ap
cbp_real_wage   float   %9.0g                 
cbp_estab       double  %12.0g                (sum) estab
cbp_emp_estab   float   %9.0g                 
nber_emp        double  %9.0g                 (sum) emp
nber_prodemp    double  %9.0g                 (sum) prodemp
nber_nprodemp   float   %9.0g                 
nber_nom_pay    double  %9.0g                 (sum) nom_pay
nber_nom_prod~y double  %9.0g                 (sum) nom_prodpay
nber_nom_vship  double  %10.0g                (sum) nom_vship
nber_nom_vadd   double  %9.0g                 (sum) nom_vadd
nber_nom_matc~t double  %10.0g                (sum) nom_matcost
nber_nom_invest double  %9.0g                 (sum) nom_invest
nber_nom_energy double  %9.0g                 (sum) nom_energy
nber_nom_cap    double  %9.0g                 (sum) nom_cap
nber_real_pay   double  %9.0g                 (sum) real_pay
nber_real_pro~y double  %9.0g                 (sum) real_prodpay
nber_real_vship double  %9.0g                 (sum) real_vship
nber_real_mat~t double  %9.0g                 (sum) real_matcost
nber_real_inv~t double  %9.0g                 (sum) real_invest
nber_real_ene~y double  %9.0g                 (sum) real_energy
nber_real_wage  float   %9.0g                 
nber_real_pro~e float   %9.0g                 
nber_real_npr~e float   %9.0g                 
nber_prodsh     float   %9.0g                 
nber_piship     float   %9.0g                 
nber_pimat      float   %9.0g                 
nber_piinv      float   %9.0g                 
nber_pien       float   %9.0g                 
real_imports_~h double  %9.0g                 US imports from China
real_exports_~h double  %9.0g                 
real_netimpor~s double  %9.0g                 
l_import_usch   float   %9.0g                 Ratio of US imports from China to
                                                1991 US market volume
l_import_otch   float   %9.0g                 Ratio of comparison countries'
                                                summed imports from China to
                                                1991 US market volum
l_export_usch   float   %9.0g                 
l_export_otch   float   %9.0g                 
real_market     float   %9.0g                 Real US market volume (in 2007 $)
manuf_purchases float   %9.0g                 Purchases from mfg industries
                                                divided by total sales
nonmanuf_purc~s float   %9.0g                 Purchases from non-mfg industries
                                                divided by total sales
resid_purchases float   %9.0g                 Purchases from residual
                                                categories divided by total
                                                sales
d_up_usch       float   %9.0g                 First-order upstream US shock
                                                defined using gross flows
d_up_otch       float   %9.0g                 First-order upstream instrument
                                                defined using gross flows
manuf_sales     float   %9.0g                 Share of sales made to mfg
                                                industries
nonmanuf_sales  float   %9.0g                 Share of sales made to non-mfg
                                                industries
resid_sales     float   %9.0g                 Share of sales made to residual
                                                categories
d_down_usch     float   %9.0g                 First-order downstream US shock
                                                defined using gross flows
d_down_otch     float   %9.0g                 First-order downstream instrument
                                                defined using gross flows
d_up_LT_usch    float   %9.0g                 Full upstream US shock defined
                                                using gross flows
d_up_LT_otch    float   %9.0g                 Full upstream instrument defined
                                                using gross flows
d_down_LT_usch  float   %9.0g                 Full downstream US shock defined
                                                using gross flows
d_down_LT_otch  float   %9.0g                 Full downstream instrument
                                                defined using gross flows
sector          byte    %19.0g     sector_lab
                                              1-digit sector
sector1         byte    %8.0g                 Food/tobacco
sector2         byte    %8.0g                 Textiles/apparel
sector3         byte    %8.0g                 Wood/furniture
sector4         byte    %8.0g                 Paper/printing
sector5         byte    %8.0g                 Chemicals/petroleum
sector6         byte    %8.0g                 Clay/stone
sector7         byte    %8.0g                 Metals
sector8         byte    %8.0g                 Equipment
sector9         byte    %8.0g                 Transportation
sector10        byte    %8.0g                 Other
ind_ci_1990     float   %9.0g                 Computer investment as share of
                                                total (1990)
ind_htsh1_1990  float   %9.0g                 High-tech investment as share of
                                                total (1990)
nber_real_~1991 float   %9.0g                 
nber_emp1991    float   %9.0g                 
ind_lnavgw_1991 float   %9.0g                 Log average wage in 1991 (in 2007
                                                $)
nber_real_~1976 float   %9.0g                 
nber_emp1976    float   %9.0g                 
d_ind_lnav~7691 float   %9.0g                 Change in log real wage
                                                (1976-1991)
nber_prode~1991 float   %9.0g                 
ind_prodwe~1991 float   %9.0g                 Production workers share of
                                                employment (1991)
nber_nom_c~1991 float   %9.0g                 
nber_nom_v~1991 float   %9.0g                 
ind_capvad~1991 float   %9.0g                 Capital/value added (1991)
d_ind_shem~7691 float   %9.0g                 Change in industry share of total
                                                employment (1976-1991)
sic3            int     %10.0g                
growth_cbp_emp  float   %9.0g                 
dl_cbp_emp      float   %9.0g                 
growth_cbp_re~y float   %9.0g                 
dl_cbp_real_pay float   %9.0g                 
growth_cbp_no~y float   %9.0g                 
dl_cbp_nom_pay  float   %9.0g                 
growth_cbp_re~e float   %9.0g                 
dl_cbp_real_w~e float   %9.0g                 
growth_cbp_es~b float   %9.0g                 
dl_cbp_estab    float   %9.0g                 
growth_cbp_em~b float   %9.0g                 
dl_cbp_emp_es~b float   %9.0g                 
growth_nber_emp float   %9.0g                 
dl_nber_emp     float   %9.0g                 
growth_nb~l_pay float   %9.0g                 
dl_nber_re~_pay float   %9.0g                 
growth_nb~m_pay float   %9.0g                 
dl_nber_nom_pay float   %9.0g                 
growth_nb~_wage float   %9.0g                 
dl_nber_r~_wage float   %9.0g                 
growth~_prodemp float   %9.0g                 
dl_nber_prodemp float   %9.0g                 
growth~nprodemp float   %9.0g                 
dl_nber_nprod~p float   %9.0g                 
growt~l_prodpay float   %9.0g                 
dl_nber_re~dpay float   %9.0g                 
growt~m_prodpay float   %9.0g                 
dl_nber_no~dpay float   %9.0g                 
growt~_prodwage float   %9.0g                 
dl_nb~_prodwage float   %9.0g                 
growt~nprodwage float   %9.0g                 
dl_nb~nprodwage float   %9.0g                 
growth_~m_vship float   %9.0g                 
dl_nber_nom_v~p float   %9.0g                 
growth_nber_r~p float   %9.0g                 
dl_nber_real_~p float   %9.0g                 
growth_nber_n~d float   %9.0g                 
dl_nber_nom_v~d float   %9.0g                 
growth_nb~iship float   %9.0g                 
dl_nber_piship  float   %9.0g                 
-------------------------------------------------------------------------------
Sorted by:  sic87dd  year

.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     sic87dd |      8232    3066.742    601.0143       2011       3999
        year |      8232        2001    6.055669       1991       2011
sic87dd_desc |         0
       manuf |      8232           1           0          1          1
reclassified |      8232    .0204082    .1414005          0          1
-------------+--------------------------------------------------------
     cbp_emp |      8232    39222.15    63530.27   1.711624   630034.4
cbp_real_pay |      8232    1.74e+09    2.85e+09   67545.05   2.77e+10
 cbp_nom_pay |      8232    1.52e+09    2.49e+09   71138.74   2.35e+10
cbp_real_w~e |      8232    43034.84    12447.79   12132.39   118047.3
   cbp_estab |      8232    919.1475    2387.208          1   38302.49
-------------+--------------------------------------------------------
cbp_emp_es~b |      8232    84.16435    145.3785   1.711624   3241.271
    nber_emp |      7344    39039.84    63549.07   161.5169   655636.6
nber_prodemp |      7344    27416.43    47120.06   134.5974   518982.9
nber_nprod~p |      7344    11623.41    20058.24   26.91948     283300
nber_nom_pay |      7344    1.44e+09    2.39e+09    5410815   2.29e+10
-------------+--------------------------------------------------------
nber_no~dpay |      7344    8.37e+08    1.51e+09    3176498   1.71e+10
nber_nom_v~p |      7344    1.04e+10    2.47e+10   1.95e+07   7.33e+11
nber_nom_v~d |      7344    4.83e+09    8.81e+09    9206461   1.11e+11
nber_nom_m~t |      7344    5.56e+09    1.78e+10    8076299   6.48e+11
nber_nom_i~t |      7344    3.29e+08    8.46e+08     100000   1.76e+10
-------------+--------------------------------------------------------
nber_nom_e~y |      7344    1.98e+08    6.31e+08   134597.4   1.42e+10
nber_nom_cap |      7344    4.30e+09    9.37e+09   1.06e+07   1.20e+11
nber_re~_pay |      7344    1.68e+09    2.78e+09    5228916   2.69e+10
nber_re~dpay |      7344    9.79e+08    1.76e+09    3069712   2.03e+10
nber_real_~p |      7344    1.21e+10    3.08e+10   1.81e+07   6.86e+11
-------------+--------------------------------------------------------
nber_rea~ost |      7344    6.65e+09    2.22e+10    8076299   6.59e+11
nber_rea~est |      7344    3.44e+08    8.90e+08   96789.41   1.70e+10
nber_real~gy |      7344    2.46e+08    7.76e+08   136589.6   1.26e+10
nber_r~_wage |      7344     41975.2    11852.01   16225.16   100196.4
nb~_prodwage |      7344    35316.99    10592.04   13334.56   92698.84
-------------+--------------------------------------------------------
nb~nprodwage |      7343    58170.97    12142.57          0   289177.5
 nber_prodsh |      7344     .708284    .1192856   .1360996   .9761904
 nber_piship |      7344    .9497196    1.341826   .2960654   55.30769
  nber_pimat |      7344    .8747858      .19294   .3045928   3.741667
  nber_piinv |      7344    .9624031    .0771459   .6484703    1.63474
-------------+--------------------------------------------------------
   nber_pien |      7344    .8369565    .1350416   .4569412   1.393013
real_impor~h |      8232    4.36e+08    1.67e+09          0   4.59e+10
real_expor~h |      7840    9.01e+07    3.48e+08          0   8.42e+09
real_netim~s |      8232    9.86e+08    6.23e+09  -3.37e+10   1.22e+11
l_import_u~h |      8232    6.813944    17.08666          0   257.5351
-------------+--------------------------------------------------------
l_import_o~h |      8232     6.25256    17.28143          0   449.6921
l_export_u~h |      7840    1.132472    4.913209          0   157.3805
l_export_o~h |      7840    4.025496    11.58705          0   221.4257
 real_market |      7344    1.29e+10    3.06e+10  -1.28e+09   7.52e+11
manuf_purc~s |      8232    .2946167    .1119611   .0058238   .6546652
-------------+--------------------------------------------------------
nonmanuf_p~s |      8232    .1578328    .0730756   .0295891   .7283211
resid_purc~s |      8232    .5456808    .1354189   .1885516   1.078999
   d_up_usch |      8232    .7776522    1.084187   .0001011   16.77514
   d_up_otch |      8232    .8496763    1.042262   .0005055    11.4776
 manuf_sales |      8232    .2885249    .2928971   .0001329   .9772751
-------------+--------------------------------------------------------
nonmanuf_s~s |      8232    .2101349    .2475555          0   .9777411
 resid_sales |      8232    .5013402    .3381126   .0014722    .998701
 d_down_usch |      8232    1.428417    3.630679          0   59.07255
 d_down_otch |      8232    1.206082     2.74452          0   37.77111
d_up_LT_usch |      8232    1.153224    1.431153   .0045577    21.0945
-------------+--------------------------------------------------------
d_up_LT_otch |      8232     1.27625    1.398662   .0071155   15.11246
d_down_L~sch |      8232    2.101437    4.519713          0   61.05178
d_down_L~tch |      8232    1.791376    3.585342          0   39.20108
      sector |      8232    5.428571    2.773033          1         10
     sector1 |      8232    .1147959    .3187949          0          1
-------------+--------------------------------------------------------
     sector2 |      8232    .1326531      .33922          0          1
     sector3 |      8232    .0586735    .2350268          0          1
     sector4 |      8232    .0612245    .2397562          0          1
     sector5 |      8232    .0841837    .2776799          0          1
     sector6 |      8232    .0943878    .2923852          0          1
-------------+--------------------------------------------------------
     sector7 |      8232    .1147959    .3187949          0          1
     sector8 |      8232    .2576531    .4373685          0          1
     sector9 |      8232    .0408163    .1978765          0          1
    sector10 |      8232    .0408163    .1978765          0          1
 ind_ci_1990 |      8232    5.985932    5.725885          0   43.48042
-------------+--------------------------------------------------------
ind_hts~1990 |      8232    8.466779     5.08565   1.201436   18.25167
nber_re~1991 |      8232    1.68e+09    2.65e+09   1.83e+07   1.99e+10
nber_emp1991 |      8232    42736.48     63409.2        500     555900
ind_lna~1991 |      8232    10.49993    .2807929   9.782784   11.09474
nber_re~1976 |      8232    1.69e+09    2.68e+09   5.50e+07   2.68e+10
-------------+--------------------------------------------------------
nber_emp1976 |      8232    45036.22    61830.56       1500     490900
d_ind_l~7691 |      8232    4.149867    10.42178  -32.01176   48.06069
nber_pr~1991 |      8232    29285.46     44137.2        300     400800
ind_pro~1991 |      8232    70.67924    12.63728   18.71609   97.61905
nber_nom_c~1 |      8232    3.19e+09    6.59e+09   2.10e+07   5.81e+10
-------------+--------------------------------------------------------
nber_nom_v~1 |      8232    3.35e+09    5.34e+09   2.57e+07   4.58e+10
ind_cap~1991 |      8232    .9633486    .5693453    .185705   3.522895
d_ind_s~7691 |      8232   -.0172324    .0363913  -.4184175   .0720371
        sic3 |      8232    3062.628    601.0709       2010       3990
growth_cbp~p |      7840   -717.2078    4705.461  -91259.14   41540.02
-------------+--------------------------------------------------------
  dl_cbp_emp |      7840   -2.963571     11.0812  -292.2973   109.1629
g~p_real_pay |      7840   -1.51e+07    2.75e+08  -4.67e+09   5.27e+09
dl_cbp_rea~y |      7840   -2.001601    12.55891  -324.9806   130.3209
gr~p_nom_pay |      7840    1.57e+07    2.52e+08  -3.90e+09   4.81e+09
dl_cbp_nom~y |      7840    .0979161    12.66472  -322.9745   132.8897
-------------+--------------------------------------------------------
growth_cbp~e |      7840    423.5729    2864.448  -51836.55   40909.04
dl_cbp_rea~e |      7840    .9619701    6.227018  -107.6517   106.0871
gro~bp_estab |      7840    -6.39937    106.0532  -1754.935   2378.509
dl_cbp_estab |      7840   -.9287986     8.77893  -84.72979   181.2687
gro~mp_estab |      7840   -2.079535    27.65279  -867.6801   590.5029
-------------+--------------------------------------------------------
dl_cbp_emp~b |      7840   -2.034773    11.29997  -234.7609   106.8592
growth~r_emp |      6952   -722.0436      4941.6   -86768.3      47900
 dl_nber_emp |      6912   -3.108135    10.24543  -80.34953   73.87508
g~r_real_pay |      6952   -1.65e+07    2.47e+08  -4.00e+09   2.25e+09
dl_nbe~l_pay |      6912   -2.151164     10.3644  -86.47911   67.77945
-------------+--------------------------------------------------------
gr~r_nom_pay |      6952    1.26e+07    2.25e+08  -4.11e+09   2.04e+09
dl_nbe~m_pay |      6912   -.0499062    10.51419   -84.6255   70.08101
growth_nbe.. |      6952    391.6418    1997.263  -16489.39   22007.61
dl_nbe~_wage |      6912    .9569715    4.675102  -35.28837   43.74926
gro~_prodemp |      6952   -532.3148    3745.921   -65631.7      37000
-------------+--------------------------------------------------------
dl_nber_pr~p |      6912   -3.240306    11.10461  -119.7703   79.94679
gro~nprodemp |      6952   -189.7289    1839.913  -31073.98   16343.83
dl_nber_np~p |      6912   -2.682592    14.85223  -138.6294   239.7895
gr~l_prodpay |      6952   -1.20e+07    1.64e+08  -3.40e+09   1.92e+09
dl~l_prodpay |      6912   -2.515499    11.43939  -77.32316   75.26792
-------------+--------------------------------------------------------
gr~m_prodpay |      6952     4799728    1.50e+08  -3.18e+09   1.76e+09
dl~m_prodpay |      6912   -.4142414    11.58536  -75.43502   77.12151
gr~_prodwage |      6952    243.0795    2010.389  -15065.05   20469.49
dl~_prodwage |      6912    .7248071    5.590429  -40.26741   49.06242
gr~nprodwage |      6950     616.651    6240.304  -256912.9   48434.39
-------------+--------------------------------------------------------
dl~nprodwage |      6909    1.045999    9.912258  -219.3069   68.22018
grow~m_vship |      6952    2.47e+08    5.17e+09  -2.69e+11   1.61e+11
dl_nber_no~p |      6912    .9940505    13.41584  -115.1215   144.9109
grow~l_vship |      6952    1.20e+08    2.83e+09  -6.67e+10   9.56e+10
dl_nber_re~p |      6912   -.5797828    13.11577  -114.5534   143.6478
-------------+--------------------------------------------------------
growth_nbe~d |      6952    1.06e+08    1.49e+09  -3.13e+10   4.87e+10
dl_nber_no~d |      6912    .9602657    16.03022  -134.9479   163.5855
growth~iship |      6952    .0010196    .2647687  -8.153847   .7539197
dl_nber_pi~p |      6912    1.573833    5.853237  -158.6049   56.18531

. keep year;

.  duplicates drop;

Duplicates in terms of all variables

(8211 observations deleted)

.  sort year;

.  save ./temp/list-year, replace;
file ./temp/list-year.dta saved

.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        year |        21        2001    6.204837       1991       2011

. use ./raw/main_annual_format, clear;

.  keep sic87dd;

.  duplicates drop;

Duplicates in terms of all variables

(7840 observations deleted)

.  sort sic87dd;

.  save ./temp/list-sic87dd, replace;
file ./temp/list-sic87dd.dta saved

.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     sic87dd |       392    3066.742    601.7458       2011       3999

. ren sic87dd sic87dd_up;

.  cross using ./temp/list-sic87dd;

.  ren sic87dd sic87dd_down;

.  cross using ./temp/list-year;

.  sort sic87dd_up sic87dd_down year;

.  save ./temp/sic87-year-grid, replace;
file ./temp/sic87-year-grid.dta saved

.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
  sic87dd_up |   3226944    3066.742    600.9779       2011       3999
sic87dd_down |   3226944    3066.742    600.9779       2011       3999
        year |   3226944        2001    6.055302       1991       2011

. *** Create NBER inputs file;
. use ./raw/main_annual_format;

.  des;

Contains data from ./raw/main_annual_format.dta
  obs:         8,232                          
 vars:           124                          17 Dec 2014 20:14
 size:     4,741,632                          
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
sic87dd         int     %9.0g                 
year            int     %9.0g                 
sic87dd_desc    str41   %41s                  
manuf           byte    %9.0g                 
reclassified    byte    %9.0g                 
cbp_emp         double  %12.0g                (sum) emp
cbp_real_pay    float   %9.0g                 
cbp_nom_pay     double  %12.0g                (sum) ap
cbp_real_wage   float   %9.0g                 
cbp_estab       double  %12.0g                (sum) estab
cbp_emp_estab   float   %9.0g                 
nber_emp        double  %9.0g                 (sum) emp
nber_prodemp    double  %9.0g                 (sum) prodemp
nber_nprodemp   float   %9.0g                 
nber_nom_pay    double  %9.0g                 (sum) nom_pay
nber_nom_prod~y double  %9.0g                 (sum) nom_prodpay
nber_nom_vship  double  %10.0g                (sum) nom_vship
nber_nom_vadd   double  %9.0g                 (sum) nom_vadd
nber_nom_matc~t double  %10.0g                (sum) nom_matcost
nber_nom_invest double  %9.0g                 (sum) nom_invest
nber_nom_energy double  %9.0g                 (sum) nom_energy
nber_nom_cap    double  %9.0g                 (sum) nom_cap
nber_real_pay   double  %9.0g                 (sum) real_pay
nber_real_pro~y double  %9.0g                 (sum) real_prodpay
nber_real_vship double  %9.0g                 (sum) real_vship
nber_real_mat~t double  %9.0g                 (sum) real_matcost
nber_real_inv~t double  %9.0g                 (sum) real_invest
nber_real_ene~y double  %9.0g                 (sum) real_energy
nber_real_wage  float   %9.0g                 
nber_real_pro~e float   %9.0g                 
nber_real_npr~e float   %9.0g                 
nber_prodsh     float   %9.0g                 
nber_piship     float   %9.0g                 
nber_pimat      float   %9.0g                 
nber_piinv      float   %9.0g                 
nber_pien       float   %9.0g                 
real_imports_~h double  %9.0g                 US imports from China
real_exports_~h double  %9.0g                 
real_netimpor~s double  %9.0g                 
l_import_usch   float   %9.0g                 Ratio of US imports from China to
                                                1991 US market volume
l_import_otch   float   %9.0g                 Ratio of comparison countries'
                                                summed imports from China to
                                                1991 US market volum
l_export_usch   float   %9.0g                 
l_export_otch   float   %9.0g                 
real_market     float   %9.0g                 Real US market volume (in 2007 $)
manuf_purchases float   %9.0g                 Purchases from mfg industries
                                                divided by total sales
nonmanuf_purc~s float   %9.0g                 Purchases from non-mfg industries
                                                divided by total sales
resid_purchases float   %9.0g                 Purchases from residual
                                                categories divided by total
                                                sales
d_up_usch       float   %9.0g                 First-order upstream US shock
                                                defined using gross flows
d_up_otch       float   %9.0g                 First-order upstream instrument
                                                defined using gross flows
manuf_sales     float   %9.0g                 Share of sales made to mfg
                                                industries
nonmanuf_sales  float   %9.0g                 Share of sales made to non-mfg
                                                industries
resid_sales     float   %9.0g                 Share of sales made to residual
                                                categories
d_down_usch     float   %9.0g                 First-order downstream US shock
                                                defined using gross flows
d_down_otch     float   %9.0g                 First-order downstream instrument
                                                defined using gross flows
d_up_LT_usch    float   %9.0g                 Full upstream US shock defined
                                                using gross flows
d_up_LT_otch    float   %9.0g                 Full upstream instrument defined
                                                using gross flows
d_down_LT_usch  float   %9.0g                 Full downstream US shock defined
                                                using gross flows
d_down_LT_otch  float   %9.0g                 Full downstream instrument
                                                defined using gross flows
sector          byte    %19.0g     sector_lab
                                              1-digit sector
sector1         byte    %8.0g                 Food/tobacco
sector2         byte    %8.0g                 Textiles/apparel
sector3         byte    %8.0g                 Wood/furniture
sector4         byte    %8.0g                 Paper/printing
sector5         byte    %8.0g                 Chemicals/petroleum
sector6         byte    %8.0g                 Clay/stone
sector7         byte    %8.0g                 Metals
sector8         byte    %8.0g                 Equipment
sector9         byte    %8.0g                 Transportation
sector10        byte    %8.0g                 Other
ind_ci_1990     float   %9.0g                 Computer investment as share of
                                                total (1990)
ind_htsh1_1990  float   %9.0g                 High-tech investment as share of
                                                total (1990)
nber_real_~1991 float   %9.0g                 
nber_emp1991    float   %9.0g                 
ind_lnavgw_1991 float   %9.0g                 Log average wage in 1991 (in 2007
                                                $)
nber_real_~1976 float   %9.0g                 
nber_emp1976    float   %9.0g                 
d_ind_lnav~7691 float   %9.0g                 Change in log real wage
                                                (1976-1991)
nber_prode~1991 float   %9.0g                 
ind_prodwe~1991 float   %9.0g                 Production workers share of
                                                employment (1991)
nber_nom_c~1991 float   %9.0g                 
nber_nom_v~1991 float   %9.0g                 
ind_capvad~1991 float   %9.0g                 Capital/value added (1991)
d_ind_shem~7691 float   %9.0g                 Change in industry share of total
                                                employment (1976-1991)
sic3            int     %10.0g                
growth_cbp_emp  float   %9.0g                 
dl_cbp_emp      float   %9.0g                 
growth_cbp_re~y float   %9.0g                 
dl_cbp_real_pay float   %9.0g                 
growth_cbp_no~y float   %9.0g                 
dl_cbp_nom_pay  float   %9.0g                 
growth_cbp_re~e float   %9.0g                 
dl_cbp_real_w~e float   %9.0g                 
growth_cbp_es~b float   %9.0g                 
dl_cbp_estab    float   %9.0g                 
growth_cbp_em~b float   %9.0g                 
dl_cbp_emp_es~b float   %9.0g                 
growth_nber_emp float   %9.0g                 
dl_nber_emp     float   %9.0g                 
growth_nb~l_pay float   %9.0g                 
dl_nber_re~_pay float   %9.0g                 
growth_nb~m_pay float   %9.0g                 
dl_nber_nom_pay float   %9.0g                 
growth_nb~_wage float   %9.0g                 
dl_nber_r~_wage float   %9.0g                 
growth~_prodemp float   %9.0g                 
dl_nber_prodemp float   %9.0g                 
growth~nprodemp float   %9.0g                 
dl_nber_nprod~p float   %9.0g                 
growt~l_prodpay float   %9.0g                 
dl_nber_re~dpay float   %9.0g                 
growt~m_prodpay float   %9.0g                 
dl_nber_no~dpay float   %9.0g                 
growt~_prodwage float   %9.0g                 
dl_nb~_prodwage float   %9.0g                 
growt~nprodwage float   %9.0g                 
dl_nb~nprodwage float   %9.0g                 
growth_~m_vship float   %9.0g                 
dl_nber_nom_v~p float   %9.0g                 
growth_nber_r~p float   %9.0g                 
dl_nber_real_~p float   %9.0g                 
growth_nber_n~d float   %9.0g                 
dl_nber_nom_v~d float   %9.0g                 
growth_nb~iship float   %9.0g                 
dl_nber_piship  float   %9.0g                 
-------------------------------------------------------------------------------
Sorted by:  sic87dd  year

. collapse (mean) nber_emp nber_nom_vadd nber_nom_vship nber_piship, by(sic87dd
>  year) fast;

. sort sic87dd year;

.  save ./temp/nber-inputs, replace;
file ./temp/nber-inputs.dta saved

. *** Merge in annual data for both industries;
. use ./temp/sic87-year-grid, clear;

.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
  sic87dd_up |   3226944    3066.742    600.9779       2011       3999
sic87dd_down |   3226944    3066.742    600.9779       2011       3999
        year |   3226944        2001    6.055302       1991       2011

. ren sic87dd_up sic87dd;

.  sort sic87dd year;

. merge sic87dd year using ./temp/nber-inputs;
(note: you are using old merge syntax; see [D] merge for new syntax)
variables sic87dd year do not uniquely identify observations in the master
    data

.  assert _m==3;

.  drop _m;

. rename _all U=;

.  ren Usic87dd sic87dd_up;

.  ren Uyear year;

.  ren Usic87dd_down sic87dd;

.  sort sic87dd year;

. merge sic87dd year using ./temp/nber-inputs;
(note: you are using old merge syntax; see [D] merge for new syntax)
variables sic87dd year do not uniquely identify observations in the master
    data

.  assert _m==3;

.  drop _m;

. rename _all D=;

.  renpfix DU U;

.  ren Dsic87dd_up sic87dd_up;

.  ren Dsic87dd sic87dd_down;

.  ren Dyear year;

.  for any U D: gen Xnber_vadd=Xnber_nom_vadd;

->  gen Unber_vadd=Unber_nom_vadd
(348096 missing values generated)

->  gen Dnber_vadd=Dnber_nom_vadd
(348096 missing values generated)

.  for any U D: gen Xnber_rvadd=Xnber_nom_vadd/Xnber_piship;

->  gen Unber_rvadd=Unber_nom_vadd/Unber_piship
(348096 missing values generated)

->  gen Dnber_rvadd=Dnber_nom_vadd/Dnber_piship
(348096 missing values generated)

.  for any U D: gen Xnber_sales=Xnber_nom_vship;

->  gen Unber_sales=Unber_nom_vship
(348096 missing values generated)

->  gen Dnber_sales=Dnber_nom_vship
(348096 missing values generated)

.  for any U D: gen Xnber_rsales=Xnber_nom_vship/Xnber_piship;

->  gen Unber_rsales=Unber_nom_vship/Unber_piship
(348096 missing values generated)

->  gen Dnber_rsales=Dnber_nom_vship/Dnber_piship
(348096 missing values generated)

.  for any U D: gen Xnber_lprod=Xnber_vadd/Xnber_emp;

->  gen Unber_lprod=Unber_vadd/Unber_emp
(348096 missing values generated)

->  gen Dnber_lprod=Dnber_vadd/Dnber_emp
(348096 missing values generated)

. for any U D: gen Xnber_rlprod=Xnber_rvadd/Xnber_emp;

->  gen Unber_rlprod=Unber_rvadd/Unber_emp
(348096 missing values generated)

->  gen Dnber_rlprod=Dnber_rvadd/Dnber_emp
(348096 missing values generated)

. drop *nom*;

. compress;
  (0 bytes saved)

.  sort sic87dd_up sic87dd_down year;

.  save ./temp/sic87-year-grid-full, replace;
file ./temp/sic87-year-grid-full.dta saved

.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
  sic87dd_up |   3226944    3066.742    600.9779       2011       3999
sic87dd_down |   3226944    3066.742    600.9779       2011       3999
        year |   3226944        2001    6.055302       1991       2011
   Unber_emp |   2878848    39039.84    63544.75   161.5169   655636.6
Unber_piship |   2878848    .9497196    1.341735   .2960654   55.30769
-------------+--------------------------------------------------------
   Dnber_emp |   2878848    39039.84    63544.75   161.5169   655636.6
Dnber_piship |   2878848    .9497196    1.341735   .2960654   55.30769
  Unber_vadd |   2878848    4.83e+09    8.81e+09    9206461   1.11e+11
  Dnber_vadd |   2878848    4.83e+09    8.81e+09    9206461   1.11e+11
 Unber_rvadd |   2878848    5.49e+09    1.01e+10    8550961   1.33e+11
-------------+--------------------------------------------------------
 Dnber_rvadd |   2878848    5.49e+09    1.01e+10    8550961   1.33e+11
 Unber_sales |   2878848    1.04e+10    2.47e+10   1.95e+07   7.33e+11
 Dnber_sales |   2878848    1.04e+10    2.47e+10   1.95e+07   7.33e+11
Unber_rsales |   2878848    1.21e+10    3.08e+10   1.81e+07   6.86e+11
Dnber_rsales |   2878848    1.21e+10    3.08e+10   1.81e+07   6.86e+11
-------------+--------------------------------------------------------
 Unber_lprod |   2878848    136110.7    151449.1   22333.33    2887241
 Dnber_lprod |   2878848    136110.7    151449.1   22333.33    2887241
Unber_rlprod |   2878848    157526.6    183637.2   2421.877    3286404
Dnber_rlprod |   2878848    157526.6    183637.2   2421.877    3286404

. *** Prepare SIC3-level grid for key variables;
. use ./temp/sic87-year-grid-full, clear;

. gen Usic3=int(sic87dd_up/10);

.  gen Dsic3=int(sic87dd_down/10);

.  collapse (sum) *nber_emp *nber_vadd *nber_rvadd *nber_sales *nber_rsales, by
> (Usic3 Dsic3 year) fast;

. for any U D: gen Xnber_lprod=Xnber_vadd/Xnber_emp;

->  gen Unber_lprod=Unber_vadd/Unber_emp
(46980 missing values generated)

->  gen Dnber_lprod=Dnber_vadd/Dnber_emp
(46980 missing values generated)

. for any U D: gen Xnber_rlprod=Xnber_rvadd/Xnber_emp;

->  gen Unber_rlprod=Unber_rvadd/Unber_emp
(46980 missing values generated)

->  gen Dnber_rlprod=Dnber_rvadd/Dnber_emp
(46980 missing values generated)

. compress;
  Usic3 was float now int
  Dsic3 was float now int
  (1,530,900 bytes saved)

.  sort Usic3 Dsic3 year;

.  save ./temp/sic87-year-grid-sic3, replace;
file ./temp/sic87-year-grid-sic3.dta saved

.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
        year |    382725        2001    6.055309       1991       2011
       Usic3 |    382725    300.7556    58.49243        201        399
       Dsic3 |    382725    300.7556    58.49243        201        399
   Unber_emp |    382725    293656.7    528277.6          0    7639898
   Dnber_emp |    382725    293656.7    528277.6          0    7639898
-------------+--------------------------------------------------------
  Unber_vadd |    382725    3.63e+10    7.13e+10          0   1.29e+12
  Dnber_vadd |    382725    3.63e+10    7.13e+10          0   1.29e+12
 Unber_rvadd |    382725    4.13e+10    7.84e+10          0   1.31e+12
 Dnber_rvadd |    382725    4.13e+10    7.84e+10          0   1.31e+12
 Unber_sales |    382725    7.81e+10    1.80e+11          0   6.59e+12
-------------+--------------------------------------------------------
 Dnber_sales |    382725    7.81e+10    1.80e+11          0   6.59e+12
Unber_rsales |    382725    9.09e+10    2.12e+11          0   6.18e+12
Dnber_rsales |    382725    9.09e+10    2.12e+11          0   6.18e+12
 Unber_lprod |    335745    143352.8      200832   23086.96    2887241
 Dnber_lprod |    335745    143352.8      200832   23086.96    2887241
-------------+--------------------------------------------------------
Unber_rlprod |    335745    169587.3    246977.4   16298.35    3110508
Dnber_rlprod |    335745    169587.3    246977.4   16298.35    3110508

.  keep if year==1991;
(364500 observations deleted)

.  drop year;

. compress;
  (0 bytes saved)

.  sort Usic3 Dsic3;

.  save ./temp/sic87-year-grid-sic3-1991, replace;
file ./temp/sic87-year-grid-sic3-1991.dta saved

.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
       Usic3 |     18225    300.7556    58.49396        201        399
       Dsic3 |     18225    300.7556    58.49396        201        399
   Unber_emp |     18225    360332.4    541583.6       1500    6042600
   Dnber_emp |     18225    360332.4    541583.6       1500    6042600
  Unber_vadd |     18225    2.82e+10    4.46e+10   5.81e+07   6.69e+11
-------------+--------------------------------------------------------
  Dnber_vadd |     18225    2.82e+10    4.46e+10   5.81e+07   6.69e+11
 Unber_rvadd |     18225    3.84e+10    6.23e+10   7.32e+07   7.26e+11
 Dnber_rvadd |     18225    3.84e+10    6.23e+10   7.32e+07   7.26e+11
 Unber_sales |     18225    6.07e+10    1.08e+11   1.41e+08   1.87e+12
 Dnber_sales |     18225    6.07e+10    1.08e+11   1.41e+08   1.87e+12
-------------+--------------------------------------------------------
Unber_rsales |     18225    8.50e+10    1.70e+11   1.78e+08   3.38e+12
Dnber_rsales |     18225    8.50e+10    1.70e+11   1.78e+08   3.38e+12
 Unber_lprod |     18225    85191.77    81646.71      23240   825635.7
 Dnber_lprod |     18225    85191.77    81646.71      23240   825635.7
Unber_rlprod |     18225    125416.8    164199.8   16298.35    1615245
-------------+--------------------------------------------------------
Dnber_rlprod |     18225    125416.8    164199.8   16298.35    1615245

.  **************************;
. *** Input-output flows  **;
. **************************;
. *** Combine input-output matrices;
. * gross_flows ~ Value of gross flows from upstream to downstream in 1992;
. * tot_sales_down ~ Total sales by sic87dd_down;
. * tot_sales_up ~ Total sales by sic87dd_up;
. * produce_share ~ Share of sic87dd_up's sales that go to sic87dd_down;
. * purchase_share ~ Cost share of sic87dd_up's good in sic87dd_down's producti
> on;
. use ./raw/gross_shares, clear;

.  des;

Contains data from ./raw/gross_shares.dta
  obs:       230,400                          
 vars:             7                          27 Dec 2014 05:47
 size:     8,294,400                          
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
sic87dd_down    int     %9.0g                 SIC industry purchasing the
                                                commodity
sic87dd_up      int     %9.0g                 SIC commodity being purchased
gross_flows     double  %12.0g                Value of gross flows from
                                                upstream to downstream in 1992
tot_sales_down  double  %12.0g                Total sales by sic87dd_down
tot_sales_up    double  %12.0g                Total sales by sic87dd_up
produce_share   float   %9.0g                 Share of sic87dd_up's sales that
                                                go to sic87dd_down
purchase_share  float   %9.0g                 Cost share of sic87dd_up's good
                                                in sic87dd_down's production
-------------------------------------------------------------------------------
Sorted by:  sic87dd_down  sic87dd_up

.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
sic87dd_down |    229920    3601.674    1651.762        710       8741
  sic87dd_up |    229920    3601.674    1651.762        710       8741
 gross_flows |    230400    82.20226    7256.605          0    3204995
tot_sales_~n |    230400    39457.08    415680.7   150.6691    9038440
tot_sales_up |    230400    39457.08    415680.7   150.6691    9038440
-------------+--------------------------------------------------------
produce_sh~e |    230400    .0020833    .0314269          0          1
purchase_s~e |    230400    .0020802    .0271199          0   1.078999

. ren produce_share produce_shareD;

.  ren purchase_share purchase_shareD;

. sort sic87dd_down sic87dd_up;

.  merge sic87dd_down sic87dd_up using ./raw/leontief_down.dta, nok;
(note: you are using old merge syntax; see [D] merge for new syntax)

.  tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        959        0.42        0.42
          3 |    229,441       99.58      100.00
------------+-----------------------------------
      Total |    230,400      100.00

.  drop _m;

. sort sic87dd_up sic87dd_down;

.  merge sic87dd_up sic87dd_down using ./raw/leontief_up.dta, nok;
(note: you are using old merge syntax; see [D] merge for new syntax)

.  tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        959        0.42        0.42
          3 |    229,441       99.58      100.00
------------+-----------------------------------
      Total |    230,400      100.00

.  drop _m;

. ren produce_share produce_shareL;

.  ren purchase_share purchase_shareL;

. keep if (sic87dd_down>=2000 & sic87dd_down<=3999) & (sic87dd_up>=2000 & sic87
> dd_up<=3999);
(76736 observations deleted)

. *** Prepare flow matrix;
. gen io_perc_up=gross_flows/tot_sales_up;

.  gen io_perc_down=gross_flows/tot_sales_down;

. pwcorr produce* purchase* io_perc*;

             | produc~D produc~L purcha~D purcha~L io_per~p io_per~n
-------------+------------------------------------------------------
produce_sh~D |   1.0000 
produce_sh~L |   0.9741   1.0000 
purchase_s~D |   0.4004   0.4027   1.0000 
purchase_s~L |   0.3840   0.4002   0.9780   1.0000 
  io_perc_up |   1.0000   0.9741   0.4004   0.3840   1.0000 
io_perc_down |   0.4004   0.4027   1.0000   0.9780   0.4004   1.0000 

.  drop produce_shareD purchase_shareD;

. egen temp1=sum(io_perc_up), by(sic87dd_up);

.  gen io_nperc_up=io_perc_up/temp1;

.  drop temp1;

.  egen temp1=sum(io_perc_down), by(sic87dd_down);

.  gen io_nperc_down=io_perc_down/temp1;

.  drop temp1;

.  ren produce_shareL io_Lperc_up;

.  ren purchase_shareL io_Lperc_down;

. compress;
  (0 bytes saved)

.  sort sic87dd_up sic87dd_down;

.  save ./temp/io-grid-sort, replace;
file ./temp/io-grid-sort.dta saved

.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
sic87dd_down |    153664    3066.742    600.9797       2011       3999
  sic87dd_up |    153664    3066.742    600.9797       2011       3999
 gross_flows |    153664    6.772691    142.1782          0   38244.19
tot_sales_~n |    153664    8800.954    16949.64   150.6691   211877.4
tot_sales_up |    153664    8800.954    16949.64   150.6691   211877.4
-------------+--------------------------------------------------------
 io_Lperc_up |    153664      .00117    .0100545          0   .9192688
io_Lperc_d~n |    153664     .001196     .008565          0   .5482473
  io_perc_up |    153664     .000736    .0085948          0   .9156626
io_perc_down |    153664    .0007516    .0069816          0   .5088105
 io_nperc_up |    153664     .002551    .0243817          0          1
-------------+--------------------------------------------------------
io_nperc_d~n |    153664     .002551    .0213521          0   .9167687

. **************************;
. *** Geographic flows    **;
. **************************;
. *** Prepare aak geographic proximity matrix - sic87dd czone emp year;
. use sic87dd czone emp if (sic87dd>=2000 & sic87dd<=3999) using ./raw/cbp_czon
> e_1991, clear;

. sort sic87dd czone;

.  save ./temp/aak1, replace;
(note: file ./temp/aak1.dta not found)
file ./temp/aak1.dta saved

.  sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
     sic87dd |    283024    3066.742    600.9789       2011       3999
       czone |    283024    22132.33    11093.97        100      39400
         emp |    283024    59.62029    554.6783          0   71670.22

. keep sic87dd;

.  duplicates drop;

Duplicates in terms of all variables

(282632 observations deleted)

.  sort sic87dd;

.  save ./temp/aak1b, replace;
(note: file ./temp/aak1b.dta not found)
file ./temp/aak1b.dta saved

. use ./temp/aak1, clear;

.  egen empr=sum(emp), by(czone);

. egen empi=sum(emp), by(sic87dd);

. for var sic87dd emp: ren X X1;

->  ren sic87dd sic87dd1

->  ren emp emp1

. cross using ./temp/aak1b;

. sort sic87dd czone;

.  merge sic87dd czone using ./temp/aak1;
(note: you are using old merge syntax; see [D] merge for new syntax)
variables sic87dd czone do not uniquely identify observations in the master
    data

.  assert _m==3;

.  drop _m;

. for var sic87dd emp: ren X X2;

->  ren sic87dd sic87dd2

->  ren emp emp2

.  gen geo12=emp1*emp2/(empr*empi);
(153664 missing values generated)

. collapse (sum) geo12, by(sic87dd1 sic87dd2) fast;

. ren sic87dd1 sic87dd_down;

.  ren sic87dd2 sic87dd_up;

. compress;
  sic87dd_down was float now int
  sic87dd_up was float now int
  (614,656 bytes saved)

.  sort sic87dd_up sic87dd_down;

.  save ./temp/aak-grid-sort, replace;
file ./temp/aak-grid-sort.dta saved

. sum;

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
sic87dd_down |    153664    3066.742    600.9797       2011       3999
  sic87dd_up |    153664    3066.742    600.9797       2011       3999
       geo12 |    153664     .002551    .0048125          0   .2599952

.  for any 1 1b: erase ./temp/aakX.dta;

->  erase ./temp/aak1.dta

->  erase ./temp/aak1b.dta

. *** Geographic HHI;
. use sic87dd czone emp if (sic87dd>=2000 & sic87dd<=3999) using ./raw/cbp_czon
> e_1991, clear;

. egen temp1=sum(emp), by(sic87dd);

. gen hhi=(emp/temp1)^2;

. collapse (sum) hhi, by(sic87dd) fast;

. compress;
  sic87dd was float now int
  (784 bytes saved)

.  sort sic87dd;

.  save ./temp/sic87-hhi, replace;
file ./temp/sic87-hhi.dta saved

. **************************;
. *** 2nd Order Terms    **;
. **************************;
. /* Created intermediate file copied into raw folder for replication due to me
> mory/time requirements...
> *** Prepare aak geographic proximity matrix for higher-order terms;
> use sic87dd czone emp if (sic87dd>=2000 & sic87dd<=3999) using ./raw/cbp_czon
> e_1991, clear;
> egen czone2=group(czone); drop czone; ren czone2 czone;
> sort sic87dd czone; compress; save ./temp/aak1, replace; sum;
> keep sic87dd; duplicates drop; sort sic87dd; compress; save ./temp/aak1b, rep
> lace;
> keep if sic87dd<3000; sort sic87dd; compress; save ./temp/aak1b1, replace;
> use ./temp/aak1b, clear; keep if sic87dd>=3000; sort sic87dd; compress; save 
> ./temp/aak1b2, replace;
> 
> use ./temp/aak1, clear; 
> egen empr=sum(emp), by(czone);
> egen empi=sum(emp), by(sic87dd);
> gen geo123=emp/(empr*empr*empi);
> drop if geo123==0; drop if emp<20;
> drop emp empr empi; ren sic87dd sic87dd1; compress;
> 
> cross using ./temp/aak1b; 
> sort sic87dd czone; merge sic87dd czone using ./temp/aak1, nok; drop _m;
> replace geo123=geo123*emp; drop if geo123==0; drop if emp<20; drop emp;
> for var sic87dd: ren X X2; sum; compress;
> save aak2a, replace;
> 
> cross using ./temp/aak1b1; 
> sort sic87dd czone; merge sic87dd czone using ./temp/aak1, nok; drop _m;
> replace geo123=geo123*emp; drop if geo123==0; drop if emp<20; drop emp;
> for var sic87dd: ren X X3; sum; compress;
> collapse (sum) geo123, by(sic87dd1 sic87dd2 sic87dd3) fast;
> compress; save aak2b, replace;
> 
> use aak2a, clear;
> cross using ./temp/aak1b2; 
> sort sic87dd czone; merge sic87dd czone using ./temp/aak1, nok; drop _m;
> replace geo123=geo123*emp; drop if geo123==0; drop if emp<20; drop emp;
> for var sic87dd: ren X X3; sum; compress;
> collapse (sum) geo123, by(sic87dd1 sic87dd2 sic87dd3) fast;
> compress; append using aak2b;
> 
> fillin sic87dd1 sic87dd2 sic87dd3; tab _f; drop _f;
> replace geo123=0 if geo123==.;
> sort sic87dd1 sic87dd2 sic87dd3; save ./temp/aak-grid-sort-ext, replace; sum;
> for any 2a 2b: erase aakX.dta;
> for any 1 1b 1b2: erase ./temp/aakX.dta;
> 
> use ./temp/aak-grid-sort-ext, clear; 
> drop if (sic87dd1==sic87dd2 | sic87dd1==sic87dd3 | sic87dd2==sic87dd3);
> collapse (sum) geo123, by(sic87dd1 sic87dd3) fast;
> ren sic87dd1 sic87dd_down; ren sic87dd3 sic87dd_up;
> sort sic87dd_up sic87dd_down; save ./temp/aak-grid-sort-ext-sum, replace; sum
> ; */
> 
> *****************************;
. *** Interlinkages Combined **;
. *****************************;
. *** Open industry pair grid;
. use ./temp/sic87-year-grid-full, clear;

.  keep if year==2000;
(3073280 observations deleted)

.  drop year;

. *** Merge in matrices and save;
. sort sic87dd_up sic87dd_down;

.  merge sic87dd_up sic87dd_down using ./temp/io-grid-sort, nok;
(note: you are using old merge syntax; see [D] merge for new syntax)

.  assert _m==3;

.  drop _m;

. sort sic87dd_up sic87dd_down;

.  merge sic87dd_up sic87dd_down using ./temp/aak-grid-sort, nok;
(note: you are using old merge syntax; see [D] merge for new syntax)

.  assert _m==3;

.  drop _m;

.  sort sic87dd_up sic87dd_down;

.  merge sic87dd_up sic87dd_down using ./raw/aak-grid-sort-ext-sum;
(note: you are using old merge syntax; see [D] merge for new syntax)

.  tab _m;

     _merge |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        392        0.26        0.26
          3 |    153,272       99.74      100.00
------------+-----------------------------------
      Total |    153,664      100.00

.  drop _m;

. compress;
  (0 bytes saved)

.  sort sic87dd_up sic87dd_down;

.  save ./temp/combined-networks, replace;
file ./temp/combined-networks.dta saved

. *** End of program;
. log close;
      name:  <unnamed>
       log:  /nas-vol/projects/data_vol4/wkerr_ethnicity_project/networks/macro
> /replication/nw-macro-1a.log
  log type:  text
 closed on:   1 Sep 2015, 08:21:48
-------------------------------------------------------------------------------
